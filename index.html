<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="https://www.google.com/recaptcha/api.js?render=6LcwFREsAAAAAG6z3z2lDjokb-YTmq-Mb5jOW_dJ"></script>
  </head>
  <body>
    <h4>Hoppy hippo</h4>
    <label for="name">Name</label>
    <input id="name" type="text" />
    <label for="phone">Number</label>
    <input id="phone" type="text" />
    <button type="submit" id="send">Submit</button>
  </body>
  <script>
    const name = document.getElementById("name");
    const phone = document.getElementById("phone");
    const send = document.getElementById("send");
    console.log("NO", phone.value);

    const getRecaptchaToken = async () => {
      await new Promise((resolve) => {
        grecaptcha.ready(resolve);
      });
      const token = await grecaptcha.execute("6LcwFREsAAAAAG6z3z2lDjokb-YTmq-Mb5jOW_dJ", {
        action: "contact"
      });
      return token ?? null;
    };

    const handleSubmit = async (e) => {
      const token = await getRecaptchaToken();
      console.log(token);
      if (!token) return;
      const response = await fetch(".netlify/functions/make-order", {
        method: "POST",
        body: JSON.stringify({ name: name.value, phone: phone.value, token })
      });

      console.log(await response.json());
    };

    send.addEventListener("click", handleSubmit);
  </script>
</html>
